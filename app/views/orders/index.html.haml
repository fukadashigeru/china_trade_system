/ Navigation
%nav.navbar.fixed-top.navbar-expand-lg.navbar-light.bg-light
  %a.navbar-brand{:href => "#"} China Trade System
  #navbarSupportedContent.collapse.navbar-collapse
    %ul.navbar-nav.mr-auto
      %li.nav-item
        %a.nav-link.h6{:href => "#"} 注文一覧
      %li.nav-item
        %a.nav-link.h6{:href => "#"} 買付先一覧

    %a#navbarDropdown.nav-link.dropdown-toggle{"aria-expanded" => "false", "aria-haspopup" => "true", "data-toggle" => "dropdown", :href => "#", :role => "button"}
      = current_user.name
    / この下の行に dropdown-menu-right を追加するだけ。
    %ul.dropdown-menu.dropdown-menu-right{"aria-labelledby" => "navbarDropdown"}
      %li.dropdown-item
        = link_to "別アカウントにログイン", destroy_user_session_path, method: :delete, class: "dropdown-item"
      %li.dropdown-item
        = link_to "ログアウト", destroy_user_session_path, method: :delete, class: "dropdown-item"
      .dropdown-divider
      %li.dropdown-item
        = link_to "設定", destroy_user_session_path, method: :delete, class: "dropdown-item"

.container
  - if current_user.account_type == "orderer"
    .col-md-6
    = form_tag import_orders_path, method: :post, multipart: true do |f|
      .col-md-5.my-2.search_item.input-group
        = text_field_tag 'filename',"", id: "filename", disabled: true, class: "form-control"
        = file_field_tag 'csv_file', id: "file_input", style: "display: none;", onchange: "file_selected($(this));", class: "form-control"
        = button_tag 'ファイル選択', class: %i(btn-primary csv_input_btn), type: 'button', onclick: "$('#file_input').click();", class: "form-control btn btn-primary"
      .col-md-5.my-2
        買付担当：
        = select_tag(:chinese_buyer_id,
            options_for_select(User.where(account_type: 0).map{ |o| [o.name + " 様", o.id] }))
      .col-md-5.my-2
        %button.btn.btn-success.btn-block{:type => "submit"} インポート
  %table.table.table-hover.table-responsive
    %thead
      %tr
        %th.align-middle 注文No
        %th.align-middle 商品写真
        %th.align-middle{style: "min-width: 190px;"} 色・サイズ・数量
        %th.align-middle お届け先
        %th.align-middle 予定費用
        %th.align-middle 実績費用
        %th.align-middle 発注状況
        %th.align-middle 直接編集
      -@orders.each do |order|
        %tr
          %td.align-middle
            = order.trade_no
          %td.align-middle{id: "pictures-1-#{order.id}"}
            - if order.pictures.empty?
              %div{id: "picture-1-#{order.id}"}
                = link_to "画像リンクを入力してください", new_picture_path(order_id: order.id, button: 1), remote: true, class: "btn btn-light pull-right edit-btn", style: "color: gray;", title: 'クリックして入力', data: { toggle: "tooltip", placement: "right"}
            - else
              - order.pictures.each do |picture|
                %img{:src => picture.url, :style => "height: 150px;"}/
              %div{id: "picture-1-#{order.id}"}
                = link_to "+", new_picture_path(order_id: order.id, button: 1), remote: true, class: "btn btn-light pull-right edit-btn"
          %td.align-middle
            数量: 
            = order.quantity
            %hr/
            色・サイズ： 
            = order.color_size
            %hr/
            %div{id: "taobao_color_size-#{order.id}"}
              颜色・尺寸: 
              - if order.taobao_color_size.present?
                - if order.taobao_color_size.name.present?
                  = link_to "#{order.taobao_color_size.name}", edit_taobao_color_size_path(order.taobao_color_size.id), remote: true, class: "btn btn-light pull-right edit-btn"
                - else
                  = link_to "色・サイズを中国語で入力", edit_taobao_color_size_path(order.taobao_color_size.id), remote: true, class: "btn btn-light pull-right edit-btn", style: "color: gray;", title: 'クリックして入力', data: { toggle: "tooltip", placement: "right"}
              - else
                = link_to "色・サイズを中国語で入力", new_taobao_color_size_path(order_id: order.id), remote: true, class: "btn btn-light pull-right edit-btn", style: "color: gray;", title: 'クリックして入力', data: { toggle: "tooltip", placement: "right"}
          %td.align-middle.h6.small{style: "max-width: 150px;"}
            = order.postal
            %br
            = order.address
            %br
            = order.customer_name
            %br
            = order.phone
          %td.align-middle
            = ""
          %td.align-middle
            = ""
          %td.align-middle
            = ""
          %td.align-middle
            -# = link_to edit_order_path(id: order.id), class: "btn btn-blue btn-ml", remote: true do
            = link_to edit_order_path(order.id), class: "btn btn-blue btn-ml", remote: true do
              %i.far.fa-edit
          -# %td.align-middle
          -#   = ""
          -# %td.align-middle
          -#   = ""
          -# %td.align-middle
          -#   = ""
          -# %td.align-middle
          -#   = ""
          -# %td.align-middle
          -#   = ""

:javascript
  $(document).on('change', ':file', function() {
    var input = $(this),
    numFiles = input.get(0).files ? input.get(0).files.length : 1,
    label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
    input.parent().parent().next(':text').val(label);
  });
  function file_selected(file_field){
    var filename = $(file_field)[0].files[0].name;
    $("#filename").val(filename);
  }
  $(function(){
    $("#operations").change(function(){
      $("#operations").submit();
    });
  });
  $("#chinese_buyer_id").select2({width:'auto'});
